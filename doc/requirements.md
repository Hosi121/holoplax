# Holoplax 要件たたき台（壁打ち用）

## 目的
- 人生タスクをアジャイル運用（スプリント＋ベロシティ）で回す。
- バックログを自動で貯め、スコアリングして AI による自動処理／分解を行う。
- AWS デプロイ前提（S3 互換は MinIO）、Docker でコンテナ化。

## 決定事項（v0 方針）
- スプリント長: デフォルト 1 週。
- キャパ: ポイントベース（時間は参考値扱い）。
- スコア重み: 初期は人が決める。ログを元に AI が徐々に模倣する想定。
- スコア入力: ストーリーポイントが主、緊急度などはスライダー等で別入力。
- 通知チャネル: いったん無し（MVP では無視）。
- 多言語対応: 不要（日本語のみ）。
- デバイス: PC 前提（モバイル最適化は後回し）。
- セキュリティ/認証: NextAuth でマルチユーザ化。
- タイムゾーン: ひとまず日本時間固定。
- バックアップ/復元: MVP では後回し。
- 監査ログ: 低優先（後回し）。
- インフラ: docker-compose 前提、DB は Postgres、S3 互換は MinIO を同時に立ち上げる。
- モックフェーズ: 匿名化や高度なセキュリティは現段階では考慮しない（NextAuth のみ）。
- インポート UX: 取り込み時は「分析中」待ち画面を出し、その後カード形式で 1 件ずつ〇/×確認。

## 想定ユーザー
- 個人／スモールチームで自己タスクを可視化・自動化したい人。
- スプリントごとにキャパを決め、予測可能性を高めたい人。

## 主要画面（候補）
- Backlog intake：複数インボックスからの自動取込＋タグ／スコア。
- Sprint desk：スプリント作成、キャパ設定（オンボーディングのバブル Q&A）、スコープ確定。
- Velocity radar：スプリント履歴、ベロシティ推移、予測レンジ。
- Automation lab：スコアに応じた自動処理／分解提案、AI への委任状況。
- Settings/Integrations：接続元（カレンダー／メール／メモ／チャット）、AI 実行ポリシー、通知。

## ユースケース
- **Capture**：メール・カレンダー・ノート・チャットから自動登録／タグ付け。
- **Commit**：スプリント開始時にキャパ（時間 or ポイント）を決め、候補を自動プラン。
- **Execute**：低スコアは自動実行 or defer、高スコアは分解提案後にコミット。
- **Review**：スプリント完了時にベロシティ更新、完了／自動処理の内訳を振り返り。

## 機能要素（初期スコープ）
- スコアリング（例: 0-100）：工数・不確実性・価値から算出。しきい値で挙動を変える。
  - 重み付けは初期は人が設定、ログを AI が学習して近似していく。
  - 入力はストーリーポイント（必須）＋緊急度/リスクのスライダー（任意）。
- 依存・関連: 他タスクとの依存関係を設定できる。
- 自動アクション：
  - 低スコア（例: <35）→ AI へ自動委任 or 後回しキュー。
  - 中スコア（35-70）→ 分解提案／依存関係チェック。
  - 高スコア（>70）→ 分割必須、レビューを挟んでコミット。
- ベロシティ計測：スプリント単位（デフォルト 1 週）。オンボーディング時にターゲット設定。
- キャパ管理：ポイントベース（オンボーディングで目安ポイントを決める）。
- インボックス連携（段階的実装）：手入力 → メモ取り込み → カレンダー → メール → チャット。
- 通知／フォローアップ：MVP では無し。後続で検討。
- 実行ガードレール：送信・予約・購入などは自動実行しない。ワンクリックで送れる状態まで準備する UI。
- AI 委任のしきい値: 閾値をユーザが調整可能。
- 認証: メール+パスワードに加え、Google/GitHubのOAuthも利用可能。
- 管理者ロール: 管理者は全ユーザのデータ参照・管理が可能（MVPは閲覧中心）。
- 認証拡張: メール認証とパスワード再設定フローを提供。
- アイコン画像: 画像アップロードで設定（URL手入力はしない）。
- スプリント画面: 完了タスクは別セクションで表示。
- 管理者画面: ユーザー管理と監査ログを提供。
- ワークスペース: 作成/招待/メンバー管理が可能。
- ベロシティ集計: AI 完了タスクも含めチームのベロシティに計上。
- 重複判定: インポート時に「同じタスクかも？」を提示し、〇/×でマージ可。
- モックフェーズ: 匿名化や高度なセキュリティ要件は未対応で OK（NextAuth のみ）。
- 自動分解の単位: ポイント上限で分解基準を持つ（例: N ポイント以上は分解提案）。
- インポート UX: 「分析中」待ち → カードで 1 件ずつ〇/×確認。

## 非機能・インフラ
- ランタイム: Next.js / React
- コンテナ: docker-compose（web + Postgres + MinIO）
- DB: Postgres（docker-compose で起動）
- ストレージ: MinIO（S3 互換）を前提、将来 AWS S3 に切替可能な抽象化
- 認証: NextAuth（マルチユーザ想定）
- CI/CD: AWS 向けデプロイ（後で pipeline 設計）

## データの初期イメージ
- Task: {id, title, description, points, urgency, risk, status, sprintId?, source, tags[], createdAt, updatedAt}
- Sprint: {id, name, startDate, endDate, capacityPoints, plannedPoints, velocity}
- IntakeSource: {id, type (calendar/email/note/chat/manual), authRef}
- AutomationRule: {id, thresholdRange, actionType (auto-handle/split/defer), aiEnabled}
- User: {id, name, email, role, createdAt}
- EmailVerificationToken: {userId, token, expiresAt}
- PasswordResetToken: {userId, token, expiresAt, used}
- WorkspaceInvite: {workspaceId, email, role, token, expiresAt, acceptedAt}
- AuditLog: {actorId, action, targetUserId?, targetWorkspaceId?, metadata?, createdAt}

## まだ決まっていないこと・壁打ちしたい質問
- 緊急度/リスク以外に補助スライダーを追加するか？（外部依存など）
- インボックスの優先実装順は？（手入力 > メモ > カレンダー > メール > チャット）
- AI に任せるときの承認フロー要否？（しきい値で自動／要承認切替）
- 自動分解の上限ポイントは？（例: 8pt を超えたら分解提案）
- 手動上書きのポリシーは？（AI提案への同意／拒否ログ）
- インポート時の重複判定ルール詳細は？（タイトル＋日時＋ソースでどこまで自動判定し、〇/×二択の UX をどう配置するか）
- データ保持と削除: AI 学習ログや完了タスクの保持期間は？（MVP での最低限は？）
- 管理者ができる範囲: 閲覧のみか、ユーザ管理（権限変更/停止）まで含めるか？

## 次のアクション例
- 上記の未決事項を埋めて v0 スコープを確定。
- インテグレーションの優先順を決め、MVP で「手入力＋メモ取り込み」から着手。
- docker-compose と MinIO ローカル構成、AWS デプロイ手順の下書きを追加。
